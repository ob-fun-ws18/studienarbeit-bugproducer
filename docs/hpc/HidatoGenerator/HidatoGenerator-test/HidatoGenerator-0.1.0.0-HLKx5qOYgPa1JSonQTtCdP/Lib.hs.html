<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<style type="text/css">
span.lineno { color: white; background: #aaaaaa; border-right: solid white 12px }
span.nottickedoff { background: yellow}
span.istickedoff { background: white }
span.tickonlyfalse { margin: -1px; border: 1px solid #f20913; background: #f20913 }
span.tickonlytrue  { margin: -1px; border: 1px solid #60de51; background: #60de51 }
span.funcount { font-size: small; color: orange; z-index: 2; position: absolute; right: 20 }
span.decl { font-weight: bold }
span.spaces    { background: white }
</style>
</head>
<body>
<pre>
<span class="decl"><span class="nottickedoff">never executed</span> <span class="tickonlytrue">always true</span> <span class="tickonlyfalse">always false</span></span>
</pre>
<pre>
<span class="lineno">    1 </span>module Lib where
<span class="lineno">    2 </span>
<span class="lineno">    3 </span>import System.IO (hSetBuffering, BufferMode(NoBuffering), stdout)
<span class="lineno">    4 </span>import Data.Matrix
<span class="lineno">    5 </span>import System.Random
<span class="lineno">    6 </span>
<span class="lineno">    7 </span>------------------------------------------------------------
<span class="lineno">    8 </span>-- Data
<span class="lineno">    9 </span>------------------------------------------------------------
<span class="lineno">   10 </span>
<span class="lineno">   11 </span>data Playground = Playground {
<span class="lineno">   12 </span>        <span class="nottickedoff"><span class="decl"><span class="nottickedoff">normalMatrix</span></span></span> :: Matrix Int -- ^ Matrix used for filling and playing.
<span class="lineno">   13 </span>    ,   <span class="nottickedoff"><span class="decl"><span class="nottickedoff">controlMatrix</span></span></span> :: Matrix Int -- ^ Matrix used to validate the Solution.
<span class="lineno">   14 </span>    ,   <span class="nottickedoff"><span class="decl"><span class="nottickedoff">field</span></span></span> :: Field -- ^ Field that was most recently used.
<span class="lineno">   15 </span>    ,   <span class="nottickedoff"><span class="decl"><span class="nottickedoff">startField</span></span></span> :: Field -- ^ The Starting Field of the Game.
<span class="lineno">   16 </span>    ,   <span class="nottickedoff"><span class="decl"><span class="nottickedoff">size</span></span></span> :: Int -- ^ Size of the Playground.
<span class="lineno">   17 </span>    ,   <span class="nottickedoff"><span class="decl"><span class="nottickedoff">solved</span></span></span> :: Bool -- ^ Indicates if the last checked solution is correct.
<span class="lineno">   18 </span>} deriving(<span class="decl"><span class="istickedoff">Eq</span></span>,<span class="decl"><span class="nottickedoff">Show</span></span>)
<span class="lineno">   19 </span> 
<span class="lineno">   20 </span>
<span class="lineno">   21 </span>data Field = Field {
<span class="lineno">   22 </span>        <span class="nottickedoff"><span class="decl"><span class="nottickedoff">val</span></span></span> :: Int -- ^ Value of the field.
<span class="lineno">   23 </span>    ,   <span class="nottickedoff"><span class="decl"><span class="nottickedoff">pos</span></span></span> :: (Int,Int) -- ^ Position of the field.
<span class="lineno">   24 </span>}deriving(<span class="decl"><span class="istickedoff">Eq</span></span>,<span class="decl"><span class="nottickedoff">Show</span></span>)
<span class="lineno">   25 </span>
<span class="lineno">   26 </span>------------------------------------------------------------
<span class="lineno">   27 </span>-- Getters for Data
<span class="lineno">   28 </span>------------------------------------------------------------
<span class="lineno">   29 </span>
<span class="lineno">   30 </span>-- | Getter for the matrix of the playground.
<span class="lineno">   31 </span>getMatrix :: Playground -&gt; Matrix Int
<span class="lineno">   32 </span><span class="decl"><span class="istickedoff">getMatrix (Playground m _ _ _ _ _) = m</span></span>
<span class="lineno">   33 </span>
<span class="lineno">   34 </span>-- | Getter for the control matrix of the playground.
<span class="lineno">   35 </span>getControlMatrix :: Playground -&gt; Matrix Int
<span class="lineno">   36 </span><span class="decl"><span class="istickedoff">getControlMatrix (Playground _ cm _ _ _ _) = cm</span></span>
<span class="lineno">   37 </span>
<span class="lineno">   38 </span>-- | Getter for the field of the playground.
<span class="lineno">   39 </span>getField :: Playground -&gt; Field
<span class="lineno">   40 </span><span class="decl"><span class="istickedoff">getField (Playground _  _ f _ _ _) = f</span></span>
<span class="lineno">   41 </span>
<span class="lineno">   42 </span>-- | Getter for the start field of the playground.
<span class="lineno">   43 </span>getStartField :: Playground -&gt; Field
<span class="lineno">   44 </span><span class="decl"><span class="istickedoff">getStartField (Playground _  _ _ sf _ _) = sf</span></span>
<span class="lineno">   45 </span>
<span class="lineno">   46 </span>-- | Getter for the size of the playground.
<span class="lineno">   47 </span>getSize :: Playground -&gt; Int
<span class="lineno">   48 </span><span class="decl"><span class="istickedoff">getSize (Playground _ _ _  _ si _) = si</span></span>
<span class="lineno">   49 </span>
<span class="lineno">   50 </span>-- | Getter for the solved status of the playground.
<span class="lineno">   51 </span>getStatus :: Playground -&gt; Bool
<span class="lineno">   52 </span><span class="decl"><span class="istickedoff">getStatus (Playground _ _ _ _ _ sol) = sol</span></span>
<span class="lineno">   53 </span>
<span class="lineno">   54 </span>-- | Getter for the value of the field.
<span class="lineno">   55 </span>getValue :: Field -&gt; Int
<span class="lineno">   56 </span><span class="decl"><span class="istickedoff">getValue (Field value _ ) = value</span></span>
<span class="lineno">   57 </span>
<span class="lineno">   58 </span>-- | Getter for the position of the field.
<span class="lineno">   59 </span>getPosition :: Field -&gt; (Int,Int)
<span class="lineno">   60 </span><span class="decl"><span class="istickedoff">getPosition (Field _ position) = position</span></span>
<span class="lineno">   61 </span>
<span class="lineno">   62 </span>------------------------------------------------------------
<span class="lineno">   63 </span>-- Functions and Procedures
<span class="lineno">   64 </span>------------------------------------------------------------
<span class="lineno">   65 </span>
<span class="lineno">   66 </span>-- | Creates a zero Matrix.
<span class="lineno">   67 </span>generateEmptyMatrix :: Int          -- ^ Size of the matrix.
<span class="lineno">   68 </span>                    -&gt; Matrix Int   -- ^ The zero matrix.
<span class="lineno">   69 </span><span class="decl"><span class="istickedoff">generateEmptyMatrix size = zero size size</span></span>
<span class="lineno">   70 </span>
<span class="lineno">   71 </span>-- | Sets the start point.
<span class="lineno">   72 </span>setStartPoint   :: Matrix Int   -- ^ Matrix to put the start point in.
<span class="lineno">   73 </span>                -&gt; (Int,Int)    -- ^ Position for the start point.
<span class="lineno">   74 </span>                -&gt; Int          -- ^ Size of the Playground.
<span class="lineno">   75 </span>                -&gt; Playground   -- ^ The playground with a set start point.
<span class="lineno">   76 </span><span class="decl"><span class="istickedoff">setStartPoint mat (x,y) size = r where</span>
<span class="lineno">   77 </span><span class="spaces">    </span><span class="istickedoff">m = setElem 1 (x, y) mat</span>
<span class="lineno">   78 </span><span class="spaces">    </span><span class="istickedoff">r = Playground m m (Field 1 (x,y)) (Field 1 (x,y)) size False</span></span>
<span class="lineno">   79 </span>
<span class="lineno">   80 </span>-- | Calculates the neighbours of the given position with a 0 value.
<span class="lineno">   81 </span>calcNeighbours  :: Matrix Int   -- ^ Matrix to search in.
<span class="lineno">   82 </span>                -&gt; (Int,Int)    -- ^ Position of the field.
<span class="lineno">   83 </span>                -&gt; Int          -- ^ Size of the playground.
<span class="lineno">   84 </span>                -&gt; [Field]      -- ^ Returns a field list.
<span class="lineno">   85 </span><span class="decl"><span class="istickedoff">calcNeighbours matrix (xValue,yValue) size = r where</span>
<span class="lineno">   86 </span><span class="spaces">    </span><span class="istickedoff">upperLeft = upperLeftNeighbour matrix (xValue,yValue) <span class="nottickedoff">size</span></span>
<span class="lineno">   87 </span><span class="spaces">    </span><span class="istickedoff">upper = upperNeighbour matrix (xValue,yValue) <span class="nottickedoff">size</span></span>
<span class="lineno">   88 </span><span class="spaces">    </span><span class="istickedoff">upperRight = upperRightNeighbour matrix (xValue,yValue) size</span>
<span class="lineno">   89 </span><span class="spaces">    </span><span class="istickedoff">left = leftNeighbour matrix (xValue,yValue) <span class="nottickedoff">size</span></span>
<span class="lineno">   90 </span><span class="spaces">    </span><span class="istickedoff">right = rightNeighbour matrix (xValue,yValue) size</span>
<span class="lineno">   91 </span><span class="spaces">    </span><span class="istickedoff">lowerLeft = lowerLeftNeighbour matrix (xValue,yValue) size</span>
<span class="lineno">   92 </span><span class="spaces">    </span><span class="istickedoff">lower = lowerNeighbour matrix (xValue,yValue) size</span>
<span class="lineno">   93 </span><span class="spaces">    </span><span class="istickedoff">lowerRight = lowerRightNeighbour matrix (xValue,yValue) size</span>
<span class="lineno">   94 </span><span class="spaces">    </span><span class="istickedoff">neighbourList = [upperLeft,upper,upperRight,left,right,lowerLeft,lower,lowerRight]</span>
<span class="lineno">   95 </span><span class="spaces">    </span><span class="istickedoff">neighbourListFinal = filter (\x -&gt; getValue x == 0) neighbourList</span>
<span class="lineno">   96 </span><span class="spaces">    </span><span class="istickedoff">r = neighbourListFinal</span></span>
<span class="lineno">   97 </span>
<span class="lineno">   98 </span>-- | Calculates if there is a valid upper neighbour.
<span class="lineno">   99 </span>upperNeighbour  :: Matrix Int   -- ^ Matrix to search in.
<span class="lineno">  100 </span>                -&gt; (Int,Int)    -- ^ Position of the field
<span class="lineno">  101 </span>                -&gt; Int          -- ^ Size of the playground for range check.
<span class="lineno">  102 </span>                -&gt; Field        -- ^ returns a field.
<span class="lineno">  103 </span><span class="decl"><span class="istickedoff">upperNeighbour matrix (x,y) size = </span>
<span class="lineno">  104 </span><span class="spaces">    </span><span class="istickedoff">if x-1 &gt;= 1 </span>
<span class="lineno">  105 </span><span class="spaces">        </span><span class="istickedoff">then Field (getElem (x-1) y matrix) ((x-1),y)</span>
<span class="lineno">  106 </span><span class="spaces">        </span><span class="istickedoff">else Field (-1) ((x-1),y)</span></span>
<span class="lineno">  107 </span>
<span class="lineno">  108 </span>-- | Calculates if there is a valid lower neighbour.
<span class="lineno">  109 </span>lowerNeighbour  :: Matrix Int   -- ^ Matrix to search in.
<span class="lineno">  110 </span>                -&gt; (Int,Int)    -- ^ Position of the field
<span class="lineno">  111 </span>                -&gt; Int          -- ^ Size of the playground for range check.
<span class="lineno">  112 </span>                -&gt; Field        -- ^ returns a field.
<span class="lineno">  113 </span><span class="decl"><span class="istickedoff">lowerNeighbour matrix (x,y) size= </span>
<span class="lineno">  114 </span><span class="spaces">    </span><span class="istickedoff">if x+1 &lt;= size</span>
<span class="lineno">  115 </span><span class="spaces">        </span><span class="istickedoff">then Field (getElem (x+1) y matrix) ((x+1),y) </span>
<span class="lineno">  116 </span><span class="spaces">        </span><span class="istickedoff">else Field (-1) ((x+1),y)</span></span>
<span class="lineno">  117 </span>
<span class="lineno">  118 </span>-- | Calculates if there is a valid left neighbour.
<span class="lineno">  119 </span>leftNeighbour   :: Matrix Int   -- ^ Matrix to search in.
<span class="lineno">  120 </span>                -&gt; (Int,Int)    -- ^ Position of the field
<span class="lineno">  121 </span>                -&gt; Int          -- ^ Size of the playground for range check.
<span class="lineno">  122 </span>                -&gt; Field        -- ^ returns a field.
<span class="lineno">  123 </span><span class="decl"><span class="istickedoff">leftNeighbour matrix (x,y) size= </span>
<span class="lineno">  124 </span><span class="spaces">    </span><span class="istickedoff">if y-1 &gt;= 1 </span>
<span class="lineno">  125 </span><span class="spaces">        </span><span class="istickedoff">then Field (getElem x (y-1) matrix) (x,(y-1))</span>
<span class="lineno">  126 </span><span class="spaces">        </span><span class="istickedoff">else Field (-1) (x,(y-1))</span></span>
<span class="lineno">  127 </span>
<span class="lineno">  128 </span>-- | Calculates if there is a valid right neighbour.
<span class="lineno">  129 </span>rightNeighbour  :: Matrix Int   -- ^ Matrix to search in.
<span class="lineno">  130 </span>                -&gt; (Int,Int)    -- ^ Position of the field
<span class="lineno">  131 </span>                -&gt; Int          -- ^ Size of the playground for range check.
<span class="lineno">  132 </span>                -&gt; Field        -- ^ returns a field.
<span class="lineno">  133 </span><span class="decl"><span class="istickedoff">rightNeighbour matrix (x,y) size= </span>
<span class="lineno">  134 </span><span class="spaces">    </span><span class="istickedoff">if y+1 &lt;= size</span>
<span class="lineno">  135 </span><span class="spaces">        </span><span class="istickedoff">then Field (getElem x (y+1) matrix) (x,(y+1)) </span>
<span class="lineno">  136 </span><span class="spaces">        </span><span class="istickedoff">else Field (-1) (x,(y+1))</span></span> 
<span class="lineno">  137 </span>
<span class="lineno">  138 </span>-- | Calculates if there is a valid upper left neighbour.
<span class="lineno">  139 </span>upperLeftNeighbour  :: Matrix Int   -- ^ Matrix to search in.
<span class="lineno">  140 </span>                    -&gt; (Int,Int)    -- ^ Position of the field
<span class="lineno">  141 </span>                    -&gt; Int          -- ^ Size of the playground for range check.
<span class="lineno">  142 </span>                    -&gt; Field        -- ^ returns a field.
<span class="lineno">  143 </span><span class="decl"><span class="istickedoff">upperLeftNeighbour matrix (x,y) size= </span>
<span class="lineno">  144 </span><span class="spaces">    </span><span class="istickedoff">if x-1 &gt;= 1 &amp;&amp; y-1 &gt;= 1 </span>
<span class="lineno">  145 </span><span class="spaces">        </span><span class="istickedoff">then Field (getElem (x-1) (y-1) matrix) ((x-1),(y-1)) </span>
<span class="lineno">  146 </span><span class="spaces">        </span><span class="istickedoff">else Field (-1) ((x-1),(y-1))</span></span>
<span class="lineno">  147 </span>
<span class="lineno">  148 </span>-- | Calculates if there is a valid upper right neighbour.
<span class="lineno">  149 </span>upperRightNeighbour :: Matrix Int   -- ^ Matrix to search in.
<span class="lineno">  150 </span>                    -&gt; (Int,Int)    -- ^ Position of the field
<span class="lineno">  151 </span>                    -&gt; Int          -- ^ Size of the playground for range check.
<span class="lineno">  152 </span>                    -&gt; Field        -- ^ returns a field.
<span class="lineno">  153 </span><span class="decl"><span class="istickedoff">upperRightNeighbour matrix (x,y) size= </span>
<span class="lineno">  154 </span><span class="spaces">    </span><span class="istickedoff">if x-1 &gt;= 1 &amp;&amp; y+1 &lt;= size</span>
<span class="lineno">  155 </span><span class="spaces">        </span><span class="istickedoff">then Field (getElem (x-1) (y+1) matrix) ((x-1),(y+1))</span>
<span class="lineno">  156 </span><span class="spaces">        </span><span class="istickedoff">else Field (-1) ((x-1),(y+1))</span></span>
<span class="lineno">  157 </span>
<span class="lineno">  158 </span>-- | Calculates if there is a valid lower left neighbour.
<span class="lineno">  159 </span>lowerLeftNeighbour  :: Matrix Int   -- ^ Matrix to search in.
<span class="lineno">  160 </span>                    -&gt; (Int,Int)    -- ^ Position of the field
<span class="lineno">  161 </span>                    -&gt; Int          -- ^ Size of the playground for range check.
<span class="lineno">  162 </span>                    -&gt; Field        -- ^ returns a field.
<span class="lineno">  163 </span><span class="decl"><span class="istickedoff">lowerLeftNeighbour matrix (x,y) size= </span>
<span class="lineno">  164 </span><span class="spaces">    </span><span class="istickedoff">if x+1 &lt;= size &amp;&amp; y-1 &gt;= 1 </span>
<span class="lineno">  165 </span><span class="spaces">        </span><span class="istickedoff">then Field (getElem (x+1) (y-1) matrix) ((x+1),(y-1)) </span>
<span class="lineno">  166 </span><span class="spaces">        </span><span class="istickedoff">else Field (-1) ((x+1),(y-1))</span></span> 
<span class="lineno">  167 </span>
<span class="lineno">  168 </span>-- | Calculates if there is a valid lower right neighbour.
<span class="lineno">  169 </span>lowerRightNeighbour :: Matrix Int   -- ^ Matrix to search in.
<span class="lineno">  170 </span>                    -&gt; (Int,Int)    -- ^ Position of the field
<span class="lineno">  171 </span>                    -&gt; Int          -- ^ Size of the playground for range check.
<span class="lineno">  172 </span>                    -&gt; Field        -- ^ returns a field.
<span class="lineno">  173 </span><span class="decl"><span class="istickedoff">lowerRightNeighbour matrix (x,y) size= </span>
<span class="lineno">  174 </span><span class="spaces">    </span><span class="istickedoff">if x+1 &lt;= size &amp;&amp; y+1 &lt;= size</span>
<span class="lineno">  175 </span><span class="spaces">        </span><span class="istickedoff">then Field (getElem (x+1) (y+1) matrix) ((x+1),(y+1)) </span>
<span class="lineno">  176 </span><span class="spaces">        </span><span class="istickedoff">else Field (-1) ((x+1),(y+1))</span></span> 
<span class="lineno">  177 </span>
<span class="lineno">  178 </span>-- | Sets the next point into the playground.
<span class="lineno">  179 </span>--   Uses a shuffle function to randomise the position of the field.
<span class="lineno">  180 </span>setPoint    :: Playground       -- ^ Playground to enter the point in.
<span class="lineno">  181 </span>            -&gt; Int              -- ^ Value to enter.
<span class="lineno">  182 </span>            -&gt; IO Playground    -- ^ Playground to return.
<span class="lineno">  183 </span><span class="decl"><span class="nottickedoff">setPoint playground v = do</span>
<span class="lineno">  184 </span><span class="spaces">    </span><span class="nottickedoff">let mat = getMatrix playground</span>
<span class="lineno">  185 </span><span class="spaces">    </span><span class="nottickedoff">let f = getField playground</span>
<span class="lineno">  186 </span><span class="spaces">    </span><span class="nottickedoff">let neighbours = calcNeighbours mat (getPosition f) (getSize playground)</span>
<span class="lineno">  187 </span><span class="spaces">    </span><span class="nottickedoff">shuffField &lt;- returnFieldFromNeighbours neighbours</span>
<span class="lineno">  188 </span><span class="spaces">    </span><span class="nottickedoff">let m1 = setElem v (getPosition shuffField) mat</span>
<span class="lineno">  189 </span><span class="spaces">    </span><span class="nottickedoff">let nextField = Field v (getPosition shuffField)</span>
<span class="lineno">  190 </span><span class="spaces">    </span><span class="nottickedoff">return (decider playground m1 nextField neighbours)</span></span>
<span class="lineno">  191 </span>
<span class="lineno">  192 </span>-- | Used for checking if there a is neighbour nearby.
<span class="lineno">  193 </span>decider     :: Playground   -- ^ Playground.
<span class="lineno">  194 </span>            -&gt; Matrix Int   -- ^ Matrix.
<span class="lineno">  195 </span>            -&gt; Field        -- ^ Field.
<span class="lineno">  196 </span>            -&gt; [Field]      -- ^ Neighbours list.
<span class="lineno">  197 </span>            -&gt; Playground   -- ^ Playground to return.
<span class="lineno">  198 </span><span class="decl"><span class="istickedoff">decider playground m1 shuffField neighbours = </span>
<span class="lineno">  199 </span><span class="spaces">    </span><span class="istickedoff">if neighbours == [] </span>
<span class="lineno">  200 </span><span class="spaces">        </span><span class="istickedoff">then playground</span>
<span class="lineno">  201 </span><span class="spaces">        </span><span class="istickedoff">else Playground m1 m1 shuffField (getStartField playground) (getSize playground) (getStatus playground)</span></span>
<span class="lineno">  202 </span>
<span class="lineno">  203 </span>-- | Function used to shuffle a given list.
<span class="lineno">  204 </span>shuffleList     :: [a]      -- ^ Input list.
<span class="lineno">  205 </span>                -&gt; IO [a]   -- ^ Return shuffled list.
<span class="lineno">  206 </span><span class="decl"><span class="nottickedoff">shuffleList x = if length x &lt; 2 then return x else do</span>
<span class="lineno">  207 </span><span class="spaces">    </span><span class="nottickedoff">i &lt;- System.Random.randomRIO (0, length(x)-1)</span>
<span class="lineno">  208 </span><span class="spaces">    </span><span class="nottickedoff">r &lt;- shuffleList (take i x ++ drop (i+1) x)</span>
<span class="lineno">  209 </span><span class="spaces">    </span><span class="nottickedoff">return (x!!i : r)</span></span>
<span class="lineno">  210 </span>
<span class="lineno">  211 </span>-- | Shuffles a list and returns the first value.
<span class="lineno">  212 </span>returnFieldFromNeighbours   :: [a]  -- ^ List.
<span class="lineno">  213 </span>                            -&gt; IO a -- ^ Returns the first value of the shuffled list.
<span class="lineno">  214 </span><span class="decl"><span class="nottickedoff">returnFieldFromNeighbours list = do</span>
<span class="lineno">  215 </span><span class="spaces">    </span><span class="nottickedoff">shuff &lt;- shuffleList list</span>
<span class="lineno">  216 </span><span class="spaces">    </span><span class="nottickedoff">return (shuff !! 0)</span></span>
<span class="lineno">  217 </span>
<span class="lineno">  218 </span>-- | Used to initiate the playground and fill it.
<span class="lineno">  219 </span>buildPlayground     :: Int              -- ^ Size of the playground.
<span class="lineno">  220 </span>                    -&gt; IO Playground    -- ^ Returns filled playground.
<span class="lineno">  221 </span><span class="decl"><span class="nottickedoff">buildPlayground size = do</span>
<span class="lineno">  222 </span><span class="spaces">    </span><span class="nottickedoff">let empty = generateEmptyMatrix size</span>
<span class="lineno">  223 </span><span class="spaces">    </span><span class="nottickedoff">x &lt;- randomRIO (1,size) :: IO Int</span>
<span class="lineno">  224 </span><span class="spaces">    </span><span class="nottickedoff">y &lt;- randomRIO (1,size) :: IO Int</span>
<span class="lineno">  225 </span><span class="spaces">    </span><span class="nottickedoff">let start = setStartPoint empty (x,y) size</span>
<span class="lineno">  226 </span><span class="spaces">    </span><span class="nottickedoff">let list = [2..size*size] </span>
<span class="lineno">  227 </span><span class="spaces">    </span><span class="nottickedoff">filled &lt;-  setPoints start list</span>
<span class="lineno">  228 </span><span class="spaces">    </span><span class="nottickedoff">return filled</span></span>
<span class="lineno">  229 </span>
<span class="lineno">  230 </span>-- | Used for entering all points into the playground.
<span class="lineno">  231 </span>setPoints   :: Playground       -- ^ Playground to enter the points.
<span class="lineno">  232 </span>            -&gt; [Int]            -- ^ List of points to enter.
<span class="lineno">  233 </span>            -&gt; IO Playground    -- ^ Returns the playground with set points.
<span class="lineno">  234 </span><span class="decl"><span class="nottickedoff">setPoints playground [] = return playground</span>
<span class="lineno">  235 </span><span class="spaces"></span><span class="nottickedoff">setPoints playground list = do</span>
<span class="lineno">  236 </span><span class="spaces">    </span><span class="nottickedoff">let e = list!!0</span>
<span class="lineno">  237 </span><span class="spaces">    </span><span class="nottickedoff">let restList = drop 1 list</span>
<span class="lineno">  238 </span><span class="spaces">    </span><span class="nottickedoff">pg &lt;- setPoint playground e</span>
<span class="lineno">  239 </span><span class="spaces">    </span><span class="nottickedoff">new &lt;- setPoints pg restList</span>
<span class="lineno">  240 </span><span class="spaces">    </span><span class="nottickedoff">return new</span></span>
<span class="lineno">  241 </span>
<span class="lineno">  242 </span>-- | Builds a playground and checks if it fits the wanted fill rate.
<span class="lineno">  243 </span>generatePlayground  :: Int              -- ^ Size of the playground.
<span class="lineno">  244 </span>                    -&gt; IO Playground    -- ^ Returns the built playground.
<span class="lineno">  245 </span><span class="decl"><span class="nottickedoff">generatePlayground size = do </span>
<span class="lineno">  246 </span><span class="spaces">    </span><span class="nottickedoff">pg &lt;- buildPlayground size</span>
<span class="lineno">  247 </span><span class="spaces">    </span><span class="nottickedoff">let rate = zeroRate (getMatrix pg)</span>
<span class="lineno">  248 </span><span class="spaces">    </span><span class="nottickedoff">if rate &lt; 0.2</span>
<span class="lineno">  249 </span><span class="spaces">        </span><span class="nottickedoff">then return pg</span>
<span class="lineno">  250 </span><span class="spaces">        </span><span class="nottickedoff">else do new &lt;- generatePlayground size</span>
<span class="lineno">  251 </span><span class="spaces">                </span><span class="nottickedoff">return new</span></span>
<span class="lineno">  252 </span>
<span class="lineno">  253 </span>-- | Calculates the percentages of empty to filled fields of a matrix.
<span class="lineno">  254 </span>zeroRate    :: Matrix Int   -- ^ Matrix.
<span class="lineno">  255 </span>            -&gt; Float        -- ^ Returns the percentage as float.
<span class="lineno">  256 </span><span class="decl"><span class="istickedoff">zeroRate mat = f where</span>
<span class="lineno">  257 </span><span class="spaces">    </span><span class="istickedoff">list = toList mat</span>
<span class="lineno">  258 </span><span class="spaces">    </span><span class="istickedoff">filtered = filter (\x -&gt; x == 0) list</span>
<span class="lineno">  259 </span><span class="spaces">    </span><span class="istickedoff">lengthList = length list</span>
<span class="lineno">  260 </span><span class="spaces">    </span><span class="istickedoff">lengthFiltered = length filtered</span>
<span class="lineno">  261 </span><span class="spaces">    </span><span class="istickedoff">f = (fromIntegral lengthFiltered) / (fromIntegral lengthList)</span></span>
<span class="lineno">  262 </span>
<span class="lineno">  263 </span>-- | Takes a playground with all set points and removes some of them, so that the playground is ready for playing.
<span class="lineno">  264 </span>generatePlaygroundToPlayOn  :: Playground       -- ^ Playground with all points set.
<span class="lineno">  265 </span>                            -&gt; IO Playground    -- ^ Playground with removed points for playing.
<span class="lineno">  266 </span><span class="decl"><span class="nottickedoff">generatePlaygroundToPlayOn playground = do</span>
<span class="lineno">  267 </span><span class="spaces">    </span><span class="nottickedoff">let list = toList (getMatrix playground)</span>
<span class="lineno">  268 </span><span class="spaces">    </span><span class="nottickedoff">let list2 = map (\x -&gt; if x == 0 then -1 else x) list</span>
<span class="lineno">  269 </span><span class="spaces">    </span><span class="nottickedoff">let list3 = map (\x -&gt; if x /= 1 &amp;&amp; x /= (maximum list2) &amp;&amp; x /= -1 &amp;&amp; x `mod` 4 /= 0 then 0 else x) list2</span>
<span class="lineno">  270 </span><span class="spaces">    </span><span class="nottickedoff">let m = (fromList (getSize playground) (getSize playground) list3)</span>
<span class="lineno">  271 </span><span class="spaces">    </span><span class="nottickedoff">let pg = Playground m m (getField playground) (getStartField playground) (getSize playground) (getStatus playground)</span>
<span class="lineno">  272 </span><span class="spaces">    </span><span class="nottickedoff">return pg</span></span>
<span class="lineno">  273 </span>
<span class="lineno">  274 </span>-- | Used for handling the input from the user and checks if game finished(gameloop).
<span class="lineno">  275 </span>gameHandler :: Playground -- ^ Playground to play on.
<span class="lineno">  276 </span>            -&gt; IO ()
<span class="lineno">  277 </span><span class="decl"><span class="nottickedoff">gameHandler playground = do</span>
<span class="lineno">  278 </span><span class="spaces">  </span><span class="nottickedoff">hSetBuffering stdout NoBuffering</span>
<span class="lineno">  279 </span><span class="spaces">  </span><span class="nottickedoff">input &lt;- getLine</span>
<span class="lineno">  280 </span><span class="spaces">  </span><span class="nottickedoff">let pg = handler playground input</span>
<span class="lineno">  281 </span><span class="spaces">  </span><span class="nottickedoff">print (getMatrix pg)</span>
<span class="lineno">  282 </span><span class="spaces">  </span><span class="nottickedoff">if getStatus pg == True</span>
<span class="lineno">  283 </span><span class="spaces">    </span><span class="nottickedoff">then putStrLn(&quot;  -------- !!! CONGRATULATIONS, YOUR SOLUTION IS CORRECT !!! &quot;)</span>
<span class="lineno">  284 </span><span class="spaces">    </span><span class="nottickedoff">else gameHandler pg</span></span>
<span class="lineno">  285 </span>
<span class="lineno">  286 </span>-- | Handles the input from the user and calls different functions depending on the input.
<span class="lineno">  287 </span>handler     :: Playground   -- ^ Playground.
<span class="lineno">  288 </span>            -&gt; String       -- ^ Entered input from user.
<span class="lineno">  289 </span>            -&gt; Playground   -- ^ Returns the playground.
<span class="lineno">  290 </span><span class="decl"><span class="nottickedoff">handler playground string</span>
<span class="lineno">  291 </span><span class="spaces">  </span><span class="nottickedoff">| key == [&quot;enter&quot;] = enterValue playground (valuesAsInt!!0) (valuesAsInt!!1,valuesAsInt!!2)</span>
<span class="lineno">  292 </span><span class="spaces">  </span><span class="nottickedoff">| key == [&quot;check&quot;] = checkSolution playground (getStartField playground)</span>
<span class="lineno">  293 </span><span class="spaces">  </span><span class="nottickedoff">| otherwise = playground</span>
<span class="lineno">  294 </span><span class="spaces">  </span><span class="nottickedoff">where</span>
<span class="lineno">  295 </span><span class="spaces">    </span><span class="nottickedoff">list = words string</span>
<span class="lineno">  296 </span><span class="spaces">    </span><span class="nottickedoff">(key,valuesAsString) = splitAt 1 list</span>
<span class="lineno">  297 </span><span class="spaces">    </span><span class="nottickedoff">valuesAsInt = map (read::String-&gt;Int) valuesAsString</span></span>
<span class="lineno">  298 </span>
<span class="lineno">  299 </span>-- | Function to enter a value into the playgroung.
<span class="lineno">  300 </span>--   Checks if Position is valid, so no given values are overwritten.
<span class="lineno">  301 </span>enterValue  :: Playground   -- ^ Playground.
<span class="lineno">  302 </span>            -&gt; Int          -- ^ Value to enter.
<span class="lineno">  303 </span>            -&gt; (Int,Int)    -- ^ Position to enter the value in.
<span class="lineno">  304 </span>            -&gt; Playground   -- ^ Return the playground with entered value.
<span class="lineno">  305 </span><span class="decl"><span class="istickedoff">enterValue playground value (x,y) = pg where</span>
<span class="lineno">  306 </span><span class="spaces">  </span><span class="istickedoff">mat = if (getElem x y (getControlMatrix playground)) == 0</span>
<span class="lineno">  307 </span><span class="spaces">    </span><span class="istickedoff">then setElem value (x,y) (getMatrix playground)</span>
<span class="lineno">  308 </span><span class="spaces">    </span><span class="istickedoff">else (getMatrix playground)</span>
<span class="lineno">  309 </span><span class="spaces">  </span><span class="istickedoff">pg = Playground mat (getControlMatrix playground) (getField playground) (getStartField playground) (getSize playground) (getStatus playground)</span></span>
<span class="lineno">  310 </span>  
<span class="lineno">  311 </span>-- | Function used for validating the solution from the user.
<span class="lineno">  312 </span>checkSolution   :: Playground   -- ^ Playground.
<span class="lineno">  313 </span>                -&gt; Field        -- ^ Start field of the playground.
<span class="lineno">  314 </span>                -&gt; Playground   -- ^ Returns playground with either True or False as Status solved.
<span class="lineno">  315 </span><span class="decl"><span class="istickedoff">checkSolution playground field =  </span>
<span class="lineno">  316 </span><span class="spaces">  </span><span class="istickedoff">if (calcSolutionNeighbours (getMatrix playground) field (getSize playground)) == [(getField playground)]</span>
<span class="lineno">  317 </span><span class="spaces">    </span><span class="istickedoff">then Playground (getMatrix playground) (getControlMatrix playground) (getField playground) (getStartField playground) (getSize playground) True</span>
<span class="lineno">  318 </span><span class="spaces">    </span><span class="istickedoff">else if (calcSolutionNeighbours (getMatrix playground) field (getSize playground)) == []</span>
<span class="lineno">  319 </span><span class="spaces">      </span><span class="istickedoff">then Playground (getMatrix playground) (getControlMatrix playground) (getField playground) (getStartField playground) (getSize playground) False</span>
<span class="lineno">  320 </span><span class="spaces">      </span><span class="istickedoff">else checkSolution playground ((calcSolutionNeighbours (getMatrix playground) field (getSize playground))!!0)</span></span>
<span class="lineno">  321 </span>
<span class="lineno">  322 </span>-- | Calculates if there is the correct neighbour nearby to the given field.
<span class="lineno">  323 </span>calcSolutionNeighbours  :: Matrix Int   -- ^ Matrix to search in.
<span class="lineno">  324 </span>                        -&gt; Field        -- ^ Given field to search around.
<span class="lineno">  325 </span>                        -&gt; Int          -- ^ Size of the Playground.
<span class="lineno">  326 </span>                        -&gt; [Field]      -- ^ Returns the neighbour as list.
<span class="lineno">  327 </span><span class="decl"><span class="istickedoff">calcSolutionNeighbours matrix field size = f where</span>
<span class="lineno">  328 </span><span class="spaces">  </span><span class="istickedoff">upperLeft = upperLeftNeighbour matrix (getPosition field) <span class="nottickedoff">size</span></span>
<span class="lineno">  329 </span><span class="spaces">  </span><span class="istickedoff">upper = upperNeighbour matrix (getPosition field) <span class="nottickedoff">size</span></span>
<span class="lineno">  330 </span><span class="spaces">  </span><span class="istickedoff">upperRight = upperRightNeighbour matrix (getPosition field) size</span>
<span class="lineno">  331 </span><span class="spaces">  </span><span class="istickedoff">left = leftNeighbour matrix (getPosition field) <span class="nottickedoff">size</span></span>
<span class="lineno">  332 </span><span class="spaces">  </span><span class="istickedoff">right = rightNeighbour matrix (getPosition field) size</span>
<span class="lineno">  333 </span><span class="spaces">  </span><span class="istickedoff">lowerLeft = lowerLeftNeighbour matrix (getPosition field) size</span>
<span class="lineno">  334 </span><span class="spaces">  </span><span class="istickedoff">lower = lowerNeighbour matrix (getPosition field) size</span>
<span class="lineno">  335 </span><span class="spaces">  </span><span class="istickedoff">lowerRight = lowerRightNeighbour matrix (getPosition field) size</span>
<span class="lineno">  336 </span><span class="spaces">  </span><span class="istickedoff">neighbourList = [upperLeft,upper,upperRight,left,right,lowerLeft,lower,lowerRight]</span>
<span class="lineno">  337 </span><span class="spaces">  </span><span class="istickedoff">filteredList = filter (\x -&gt; (getValue x) == ((getValue field) + 1)) neighbourList</span>
<span class="lineno">  338 </span><span class="spaces">  </span><span class="istickedoff">f = filteredList</span></span>

</pre>
</body>
</html>
